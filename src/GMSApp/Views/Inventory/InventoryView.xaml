<UserControl x:Class="GMSApp.Views.Inventory.InventoryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1300">

    <Grid Margin="9">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="360"/>
            <ColumnDefinition Width="12"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Left: Inventory list -->
        <Border Grid.Column="0" Padding="8" Background="WhiteSmoke" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0 0 0 8">
                    <Button Content="Reload" Command="{Binding LoadCommand}" Width="70" Margin="0,0,6,0"/>
                    <Button Content="New" Command="{Binding AddItemCommand}" Width="70" Margin="0,0,6,0"/>
                    <Button Content="Save" Command="{Binding SaveItemCommand}" Width="70" Margin="0,0,6,0"/>
                    <Button Content="Delete" Command="{Binding DeleteItemCommand}" Width="70"/>
                </StackPanel>

                <DataGrid ItemsSource="{Binding InventoryItems}"
                          SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          MinHeight="450">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Code" Binding="{Binding ItemCode}" Width="120"/>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                        <DataGridTextColumn Header="Stock" Binding="{Binding QuantityInStock}" Width="90"/>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>

        <GridSplitter Grid.Column="1" Width="4" ShowsPreview="True"/>

        <!-- Right: Details + transactions -->
        <Border Grid.Column="2" Padding="12" BorderBrush="#DDD" BorderThickness="1" CornerRadius="4">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Item details -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
                    <StackPanel Width="620">
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Code:" Width="120" VerticalAlignment="Center" />
                            <TextBox Text="{Binding SelectedItem.ItemCode, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="240" />
                            <TextBlock Text="Unit:" Width="80" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding Units}" SelectedItem="{Binding SelectedItem.Unit, Mode=TwoWay}" Width="140"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Name:" Width="120" VerticalAlignment="Center" />
                            <TextBox Text="{Binding SelectedItem.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="480" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Category:" Width="120" VerticalAlignment="Center" />
                            <TextBox Text="{Binding SelectedItem.Category, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="180"/>
                            <TextBlock Text="Subcategory:" Width="100" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SelectedItem.SubCategory, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="180"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Cost Price:" Width="120" VerticalAlignment="Center" />
                            <TextBox Text="{Binding SelectedItem.CostPrice, Mode=TwoWay, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                            <TextBlock Text="Sell Price:" Width="100" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SelectedItem.SellingPrice, Mode=TwoWay, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                            <TextBlock Text="Currency:" Width="80" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SelectedItem.Currency}" Width="80"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Stock:" Width="120" VerticalAlignment="Center" />
                            <TextBlock Text="{Binding SelectedItem.QuantityInStock}" VerticalAlignment="Center" FontWeight="Bold"/>
                            <TextBlock Text="Reorder Level:" Width="140" Margin="40,0,0,0" VerticalAlignment="Center"/>
                            <TextBox Text="{Binding SelectedItem.ReorderLevel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="80"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" Margin="0,0,0,6">
                            <TextBlock Text="Location:" Width="120" VerticalAlignment="Center" />
                            <TextBox Text="{Binding SelectedItem.Location, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Width="240"/>
                            <TextBlock Text="Last Restocked:" Width="140" Margin="12,0,0,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SelectedItem.LastRestocked, StringFormat=\{0:yyyy-MM-dd\}}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>

                <!-- Transactions header -->
                <TextBlock Grid.Row="2" Text="Stock Transactions" FontWeight="Bold" Margin="0,0,0,6"/>

                <!-- Transactions grid + entry -->
                <Grid Grid.Row="4">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <DataGrid ItemsSource="{Binding Transactions}" SelectedItem="{Binding SelectedTransaction, Mode=TwoWay}"
                              AutoGenerateColumns="False" CanUserAddRows="False" Grid.Row="0" MinHeight="220">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date" Binding="{Binding TransactionDate, StringFormat=\{0:yyyy-MM-dd HH:mm\}}" Width="150"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding TransactionType}" Width="120"/>
                            <DataGridTextColumn Header="Qty" Binding="{Binding Quantity}" Width="90"/>
                            <DataGridTextColumn Header="Unit Price" Binding="{Binding UnitPrice, StringFormat=N2}" Width="110"/>
                            <DataGridTextColumn Header="Line Value" Binding="{Binding LineValue, StringFormat=N2}" Width="120" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Notes" Binding="{Binding Notes}" Width="*"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Quick entry -->
                    <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,8,0,0" HorizontalAlignment="Right">
                        <ComboBox x:Name="TxnType" Width="140" SelectedIndex="0" Margin="0,0,8,0">
                            <ComboBoxItem Content="Purchase" Tag="Purchase"/>
                            <ComboBoxItem Content="JobUsage" Tag="JobUsage"/>
                            <ComboBoxItem Content="Adjustment" Tag="Adjustment"/>
                            <ComboBoxItem Content="Return" Tag="Return"/>
                        </ComboBox>
                        <TextBox x:Name="TxnQty" Width="80" Text="1" Margin="0,0,8,0"/>
                        <TextBox x:Name="TxnPrice" Width="100" Text="0.00" Margin="0,0,8,0"/>
                        <TextBox x:Name="TxnNotes" Width="300" Margin="0,0,8,0"/>
                        <Button Content="Add Txn" Width="100" Click="AddTxn_Click"/>
                        <Button Content="Delete Txn" Width="100" Margin="8,0,0,0" Command="{Binding DeleteTransactionCommand}" CommandParameter="{Binding SelectedTransaction}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>